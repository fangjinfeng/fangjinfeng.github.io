<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>林大鹏天地</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="林大鹏天地">
<meta property="og:url" content="http://fjf.com/index.html">
<meta property="og:site_name" content="林大鹏天地">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="林大鹏天地">
  
    <link rel="alternate" href="/atom.xml" title="林大鹏天地" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">林大鹏天地</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://fjf.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-UINavigationBar和UITabBar 上滚渐变显示 下拉渐变隐藏" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/16/UINavigationBar和UITabBar 上滚渐变显示 下拉渐变隐藏/" class="article-date">
  <time datetime="2017-01-16T06:00:37.000Z" itemprop="datePublished">2017-01-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/16/UINavigationBar和UITabBar 上滚渐变显示 下拉渐变隐藏/">UINavigationBar和UITabBar 上滚渐变显示 下拉渐变隐藏</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>由于项目需求要做一个这样的功能，所以做好之后，抽取出来，封装了下，希望能帮到有需要的朋友。</p>
<h1 id="1-效果图"><a href="#1-效果图" class="headerlink" title="1.效果图"></a>1.效果图</h1><p><img src="http://upload-images.jianshu.io/upload_images/2252551-b0e4d462a737c150.gif?imageMogr2/auto-orient/strip" alt="UINavigationBar和UITabbar渐变.gif"></p>
<h1 id="2-思路"><a href="#2-思路" class="headerlink" title="2.思路"></a>2.思路</h1><h2 id="A-设置tableView"><a href="#A-设置tableView" class="headerlink" title="A. 设置tableView"></a>A. 设置tableView</h2><p>a.因为当UINavigationBar和UITabBar隐藏的时候，tableView要完全占据整个屏幕，当UINavigationBar和UITabBar显示的时候，tableView又要显示在UINavigationBar下方，所以需要设置tablewView的frame和contentInset：</p>
<pre><code>self.tableView.frame = CGRectMake(0, -kNavigationBarHeight,kScreenWidth,kScreenHeight+kNavigationBarHeight);

self.tableView.contentInset = UIEdgeInsetsMake(kNavigationBarHeight,0,0,0);
</code></pre><p>B.当tableView向上移动一个属性,UINavigationBar要向上移动一个属性，UITabBar要向下移动一个像素，所以需要在- (void)scrollViewDidScroll:(UIScrollView*)scrollView方法中获取每一次tableView滚动的距离，因此需要记住上次tableView的偏移量距离：CGFloat_originalOffsetY;//上一次偏移量</p>
<pre><code>CGFloat offsetY = scrollView.contentOffset.y-_originalOffsetY;//获取每次滚动偏移的距离

_originalOffsetY = scrollView.contentOffset.y;//将这次tableView偏移量重新赋值给_originalOffsetY
</code></pre><p>又因为当UINavigationBar和UITabBar已经隐藏，继续向上滚动，已经不需要隐藏，同样的当tableView滚动到最后滚不动的时候UINavigationBar和UITabBar也不需要移动，所以添加判断条件</p>
<pre><code>//判断是否滚动到底部
CGFloat bottomOffset = scrollView.contentSize.height- scrollView.contentOffset.y- scrollView.frame.size.height; 

//判断UINavigationBar是否已经隐藏
scrollView.contentOffset.y &gt; - (2*kNavigationBarHeight)

//UIScrollView 函数
- (void)scrollViewDidScroll:(UIScrollView*)scrollView {

    CGFloat bottomOffset = scrollView.contentSize.height- scrollView.contentOffset.y- scrollView.frame.size.height;

    if(scrollView.contentOffset.y&gt; - kNavigationBarHeight &amp;&amp; bottomOffset &gt;0) {

    CGFloat offsetY = scrollView.contentOffset.y-_originalOffsetY;

    [self moveNavigationBarAndStatusBarByOffsetY:offsetY];
    }
    _originalOffsetY= scrollView.contentOffset.y;
}
</code></pre><p>C.moveNavigationBarAndStatusBarByOffsetY函数设置UINavigationBar和UITabBar相关transform.ty位置的值，同时设置相关背景图片的透明度</p>
<p>// 通过偏移量移动NavigationBar和StatusBar</p>
<ul>
<li><p>(void)moveNavigationBarAndStatusBarByOffsetY:(CGFloat)offsetY {</p>
<pre><code>CGFloat transformTy = self.navigationController.navigationBar.transform.ty;
CGFloat tabbarTransformTy = self.tabBarController.tabBar.transform.ty;
</code></pre><p>  // 向上滚动</p>
<pre><code>if (offsetY &gt; 0) {
    if (fabs(transformTy) &gt;= kNavigationBarHeight) {
    //当NavigationBar的transfrom.ty大于NavigationBar高度，导航栏离开可视范围，设置NavigationBar隐藏
        [self setNavigationBarTransformProgress:1 navigationBarStatusType:NavigationBarStatusOfTypeHidden];
} else {
    //当NavigationBar的transfrom.ty小于NavigationBar高度，导航栏在可视范围内，设置NavigationBar偏移位置和背景透明度
            [self setNavigationBarTransformProgress:offsetY navigationBarStatusType:NavigationBarStatusOfTypeNormal];
    }

    if (fabs(tabbarTransformTy) &gt;= kStatusBarHeight) {
        //当StatusTabBar的transfrom.ty大于StatusTabBar高度，导航栏离开可视范围，设置StatusTabBar隐藏
       [self setStatusBarTransformProgress:1 statusBarStatusType:StatusBarStatusTypeOfHidden];
    } else {
        //当当StatusTabBar的transfrom.ty小于StatusTabBar高度，导航栏在可视范围内，设置StatusTabBar偏移位置和背景透明度
        [self setStatusBarTransformProgress:offsetY statusBarStatusType:StatusBarStatusTypeOfNormal];
    }
</code></pre><p>// 向下滚动</p>
<pre><code>    } else if(offsetY &lt; 0){
    if (transformTy &lt; 0 &amp;&amp; fabs(transformTy) &lt;= kNavigationBarHeight) {
        //当NavigationBar的transfrom.ty小于NavigationBar高度，导航栏进入可视范围内，设置NavigationBar偏移位置和背景透明度
        [self setNavigationBarTransformProgress:offsetY navigationBarStatusType:NavigationBarStatusOfTypeNormal];
} else {
    //当NavigationBar的transfrom.ty超过NavigationBar原来位置，设置NavigationBar显示
    [self setNavigationBarTransformProgress:0 navigationBarStatusType:NavigationBarStatusOfTypeShow];
    }

    if (tabbarTransformTy &lt;= kStatusBarHeight &amp;&amp; tabbarTransformTy &gt; 0) {
        //当StatusTabBar的transfrom.ty小于StatusTabBar高度，导航栏进入可视范围内，设置StatusTabBar偏移位置和背景透明度
        [self setStatusBarTransformProgress:offsetY statusBarStatusType:StatusBarStatusTypeOfNormal];
    } else {
        //当StatusTabBar的transfrom.ty超过StatusTabBar原来位置，设置StatusTabBar显示
        [self setStatusBarTransformProgress:0 statusBarStatusType:StatusBarStatusTypeOfShow];
    }
}
</code></pre><p>}</p>
</li>
</ul>
<p>D.通过这两个函数</p>
<ul>
<li>(void)setStatusBarTransformProgress:(CGFloat)progress statusBarStatusType:(StatusBarStatusType)statusBarStatusType<br>和 </li>
<li>(void)setNavigationBarTransformProgress:(CGFloat)progress navigationBarStatusType:(NavigationBarStatusType)navigationBarStatusType<br>改变NavigationBarStatusTabBar背景图透明图和颜色</li>
</ul>
<p>// 根据传入的类型和渐变程度,改变StatusBar的颜色和位置</p>
<ul>
<li>(void)setStatusBarTransformProgress:(CGFloat)progress statusBarStatusType:    (StatusBarStatusType)statusBarStatusType{<pre><code>CGFloat transfromTy = self.tabBarController.tabBar.transform.ty;
  if (statusBarStatusType == StatusBarStatusTypeOfHidden) {
      if (transfromTy != kStatusBarHeight) {
          [self.tabBarController.tabBar fj_moveByTranslationY:kStatusBarHeight * progress];
          [self.tabBarController.tabBar fj_setImageViewAlpha:progress];
      }
   }else if(statusBarStatusType == StatusBarStatusTypeOfNormal) {
      [self.tabBarController.tabBar fj_setTranslationY:-progress];
       CGFloat alpha = 1 - fabs(self.tabBarController.tabBar.transform.ty)/kStatusBarHeight;
      [self.tabBarController.tabBar fj_setImageViewAlpha:alpha];
  }else if(statusBarStatusType == StatusBarStatusTypeOfShow) {
      if (transfromTy != 0) {
         [self.tabBarController.tabBar fj_moveByTranslationY: -kStatusBarHeight * progress];
          [self.tabBarController.tabBar fj_setImageViewAlpha:(1-progress)];
      }
  }
</code></pre>}</li>
</ul>
<p>// 根据传入的类型和渐变程度,改变NavigationBar的颜色和位置</p>
<ul>
<li>(void)setNavigationBarTransformProgress:(CGFloat)progress navigationBarStatusType:(NavigationBarStatusType)navigationBarStatusType{<br>  CGFloat transfromTy = self.navigationController.navigationBar.transform.ty;<br>  if (navigationBarStatusType == NavigationBarStatusOfTypeHidden) {<pre><code>if(transfromTy != -kNavigationBarHeight){
    [self.navigationController.navigationBar fj_moveByTranslationY:-kNavigationBarHeight * progress];
    [self.navigationController.navigationBar fj_setImageViewAlpha:progress];
}
</code></pre>  }else if(navigationBarStatusType == NavigationBarStatusOfTypeNormal) {<pre><code>[self.navigationController.navigationBar fj_setTranslationY: - progress];
CGFloat alpha = 1 - fabs(self.navigationController.navigationBar.transform.ty)/kNavigationBarHeight;
[self.navigationController.navigationBar fj_setImageViewAlpha:alpha];
</code></pre>  }else if(navigationBarStatusType == NavigationBarStatusOfTypeShow) {<pre><code>if(transfromTy != 0){
    [self.navigationController.navigationBar fj_moveByTranslationY:-kNavigationBarHeight * progress];
    [self.navigationController.navigationBar fj_setImageViewAlpha:(1-progress)];
}
</code></pre>  }<br>}<br>E.设置UITabBar和UINavigationBar类方法<br>// 设置背景图透明度</li>
<li>(void)fj_setImageViewAlpha:(CGFloat)alpha;<br>// 根据translationY在原来位置上偏移</li>
<li>(void)fj_setTranslationY:(CGFloat)translationY;<br>// 设置偏移translationY</li>
<li>(void)fj_moveByTranslationY:(CGFloat)translationY;</li>
</ul>
<p>F.在- (void)scrollViewDidEndDragging:(UIScrollView *)scrollView willDecelerate:(BOOL)decelerate函数里面判断当前NavigationBar偏移是否超过一半，如果一半则动画隐藏，如果没有则动画显示:</p>
<p>//恢复或隐藏navigationBar和statusBar</p>
<ul>
<li><p>(void)restoreNavigationBarAndStatusBarWithContentOffset:(CGPoint)contentOffset {</p>
<pre><code>CGFloat navigationBarCenterHeight  = kNavigationBarHeight/2.0;
CGFloat transformTy = self.navigationController.navigationBar.transform.ty;
if (transformTy &lt; 0 &amp;&amp; transformTy &gt; -kNavigationBarHeight) {
    if (transformTy &lt; -navigationBarCenterHeight &amp;&amp; contentOffset.y &gt; -navigationBarCenterHeight) {
        [UIView animateWithDuration:kDefaultAnimationTime animations:^{
            [self hideNavigationBarAndStatusBar];
        }];

    }else {
        [UIView animateWithDuration:kDefaultAnimationTime animations:^{
            [self showNavigationBarAndStatusBar];
        }];
    }
}
</code></pre><p>}</p>
</li>
</ul>
<h2 id="G-最后"><a href="#G-最后" class="headerlink" title="G.最后:"></a>G.最后:</h2><p>送上我最喜欢之一的动漫图:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2252551-8b5cbe64237c424d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="金木研.jpg"></p>
<p>这是<a href="https://github.com/fangjinfeng/FJGradientNavigationAndStatusBar" target="_blank" rel="external">gitHub链接</a>和<a href="http://www.jianshu.com/p/435b49da4c95" target="_blank" rel="external">简书链接</a>，大家有兴趣可以看一下，如果觉得不错，麻烦给个喜欢或星，谢谢！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fjf.com/2017/01/16/UINavigationBar和UITabBar 上滚渐变显示 下拉渐变隐藏/" data-id="ciy6otzr10000n65xg36yl96s" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/16/hello-world/" class="article-date">
  <time datetime="2017-01-16T06:00:37.000Z" itemprop="datePublished">2017-01-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/16/hello-world/">2016 总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>不知不觉间，2016已经走到年尾了。过几天就是农历的除夕了，粗略回想一下，真的觉得2016过得贼快，仿佛什么都没做，它就溜走了；但细细一想，其实这一年里也发生了很多事情。而且，对于我来说很多都是大事。</p>
<h2 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h2><p>工作是这一整年的重心，来青柠互动也一年多了，作为初创公司的元老之一，这一年基本一直走在项目的最前端，说实话，挺喜欢IT这个行业的，主要是因为IT人员：基本闷骚但大多善良；也挺喜欢青柠的，因为这里有熟悉的朋友：姜总、廖总、余红、鹏程、强哥、傲座……</p>
<h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fjf.com/2017/01/16/hello-world/" data-id="ciy6otzr60001n65xupo41fj5" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/01/16/UINavigationBar和UITabBar 上滚渐变显示 下拉渐变隐藏/">UINavigationBar和UITabBar 上滚渐变显示 下拉渐变隐藏</a>
          </li>
        
          <li>
            <a href="/2017/01/16/hello-world/">2016 总结</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 fjf<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>